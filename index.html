<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clue Detective Notepad</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background 0.3s, color 0.3s;
        }

        body.light {
            background: #f5f5f5;
            color: #2c3e50;
        }

        body.dark {
            background: #1a1a1a;
            color: #e0e0e0;
        }

        .app {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        body.light header {
            background: white;
        }

        body.dark header {
            background: #2d2d2d;
        }

        h1 {
            margin: 0;
            font-size: 28px;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }

        .reset-btn {
            background: #e74c3c;
        }

        .reset-btn:hover {
            background: #c0392b;
        }

        .dark-mode-btn {
            background: #34495e;
        }

        .dark-mode-btn:hover {
            background: #2c3e50;
        }

        .categories {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }

        .category {
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        body.light .category {
            background: white;
        }

        body.dark .category {
            background: #2d2d2d;
        }

        h2 {
            margin: 0 0 15px 0;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        body.light h2 {
            color: #34495e;
        }

        body.dark h2 {
            color: #e0e0e0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            padding: 8px;
            font-weight: 600;
            border: 1px solid;
        }

        body.light th {
            background: #ecf0f1;
            color: #2c3e50;
            border-color: #bdc3c7;
        }

        body.dark th {
            background: #3d3d3d;
            color: #e0e0e0;
            border-color: #555;
        }

        .player-header {
            padding: 4px;
        }

        .player-name-input {
            width: 100%;
            text-align: center;
            border: none;
            background: transparent;
            font-weight: 600;
            font-size: 14px;
            padding: 4px;
            border-radius: 4px;
        }

        body.light .player-name-input {
            color: #2c3e50;
        }

        body.dark .player-name-input {
            color: #e0e0e0;
        }

        .player-name-input:focus {
            outline: 2px solid #3498db;
        }

        td {
            padding: 8px;
            border: 1px solid;
            text-align: center;
        }

        body.light td {
            border-color: #bdc3c7;
        }

        body.dark td {
            border-color: #555;
        }

        .item-name {
            text-align: left;
            font-weight: 500;
            min-width: 120px;
        }

        body.light .item-name {
            background: #f8f9fa;
        }

        body.dark .item-name {
            background: #3d3d3d;
        }

        .item-name.envelope-candidate {
            font-weight: 700;
        }

        body.light .item-name.envelope-candidate {
            background: #fff3cd;
            color: #856404;
        }

        body.dark .item-name.envelope-candidate {
            background: #4a3c1a;
            color: #ffd700;
        }

        .cell {
            cursor: pointer;
            user-select: none;
            transition: background 0.15s;
            min-width: 40px;
            height: 40px;
            font-size: 18px;
            font-weight: bold;
        }

        body.light .cell:hover {
            background: #e8f4f8;
        }

        body.dark .cell:hover {
            background: #404040;
        }

        body.light .cell.checked {
            background: #d4edda;
            color: #155724;
        }

        body.dark .cell.checked {
            background: #1e4620;
            color: #4ade80;
        }

        body.light .cell.crossed {
            background: #f8d7da;
            color: #721c24;
        }

        body.dark .cell.crossed {
            background: #4a1e1e;
            color: #f87171;
        }

        body.light .cell.unsure {
            background: #fff3cd;
            color: #856404;
        }

        body.dark .cell.unsure {
            background: #4a3c1a;
            color: #fbbf24;
        }

        body.light .cell.unknown {
            background: white;
        }

        body.dark .cell.unknown {
            background: #2d2d2d;
        }

        .solution-section {
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        body.light .solution-section {
            background: white;
        }

        body.dark .solution-section {
            background: #2d2d2d;
        }

        .solution-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }

        .solution-category {
            flex: 1;
            min-width: 200px;
        }

        .solution-category h3 {
            font-size: 14px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        body.light .solution-category h3 {
            color: #7f8c8d;
        }

        body.dark .solution-category h3 {
            color: #95a5a6;
        }

        .solution-cards {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .solution-card {
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        body.light .solution-card {
            background: #ecf0f1;
            color: #2c3e50;
        }

        body.dark .solution-card {
            background: #3d3d3d;
            color: #e0e0e0;
        }

        .solution-card:hover {
            transform: translateX(4px);
        }

        body.light .solution-card:hover {
            background: #d5dbdb;
        }

        body.dark .solution-card:hover {
            background: #4a4a4a;
        }

        .solution-card.selected {
            border-color: #3498db;
        }

        body.light .solution-card.selected {
            background: #3498db;
            color: white;
        }

        body.dark .solution-card.selected {
            background: #2980b9;
            color: white;
        }

        .accusation-display {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
        }

        body.light .accusation-display {
            background: #e8f4f8;
            color: #2c3e50;
        }

        body.dark .accusation-display {
            background: #1e3a4a;
            color: #e0e0e0;
        }

        .notes-section {
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        body.light .notes-section {
            background: white;
        }

        body.dark .notes-section {
            background: #2d2d2d;
        }

        .notes-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid;
            border-radius: 4px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px;
            margin-top: 10px;
            resize: vertical;
        }

        body.light .notes-textarea {
            background: #f8f9fa;
            border-color: #bdc3c7;
            color: #2c3e50;
        }

        body.dark .notes-textarea {
            background: #1a1a1a;
            border-color: #555;
            color: #e0e0e0;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .legend {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .legend-box {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 1px solid;
        }

        body.light .legend-box {
            border-color: #bdc3c7;
        }

        body.dark .legend-box {
            border-color: #555;
        }

        @media (max-width: 768px) {
            .app {
                padding: 10px;
            }

            header {
                flex-direction: column;
                gap: 15px;
            }

            h1 {
                font-size: 22px;
            }

            .header-controls {
                width: 100%;
                justify-content: center;
            }

            table {
                font-size: 14px;
            }

            .cell {
                min-width: 30px;
                height: 30px;
                padding: 4px;
                font-size: 14px;
            }

            th, td {
                padding: 4px;
            }

            .solution-content {
                flex-direction: column;
            }

            .accusation-display {
                font-size: 16px;
            }
        }
    </style>
</head>
<body class="light">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useCallback, useEffect } = React;

        const SUSPECTS = ['Green', 'Mustard', 'Peacock', 'Plum', 'Scarlett', 'White'];
        const WEAPONS = ['Candlestick', 'Dagger', 'Lead Pipe', 'Revolver', 'Rope', 'Wrench'];
        const ROOMS = ['Ballroom', 'Billiard Room', 'Conservatory', 'Dining Room', 'Hall', 'Kitchen', 'Library', 'Lounge', 'Study'];

        const PLAYER_COUNT = 6;
        const CELL_STATES = {
            UNKNOWN: 'unknown',
            CHECKED: 'checked',
            CROSSED: 'crossed',
            UNSURE: 'unsure'
        };

        const STATE_SYMBOLS = {
            [CELL_STATES.UNKNOWN]: '',
            [CELL_STATES.CHECKED]: '‚úì',
            [CELL_STATES.CROSSED]: '‚úó',
            [CELL_STATES.UNSURE]: '?'
        };

        const STATE_CYCLE = [
            CELL_STATES.UNKNOWN,
            CELL_STATES.CHECKED,
            CELL_STATES.CROSSED,
            CELL_STATES.UNSURE
        ];

        const CATEGORIES = {
            suspects: SUSPECTS,
            weapons: WEAPONS,
            rooms: ROOMS
        };

        const CATEGORY_LABELS = {
            suspects: 'WHO?',
            weapons: 'WHAT?',
            rooms: 'WHERE?'
        };

        const ClueTracker = () => {
            const createInitialState = useCallback(() => {
                return Object.entries(CATEGORIES).reduce((acc, [category, items]) => {
                    acc[category] = items.reduce((itemAcc, item) => {
                        itemAcc[item] = Array.from({ length: PLAYER_COUNT }, () => CELL_STATES.UNKNOWN);
                        return itemAcc;
                    }, {});
                    return acc;
                }, {});
            }, []);

            const [state, setState] = useState(createInitialState);
            const [playerNames, setPlayerNames] = useState(
                Array.from({ length: PLAYER_COUNT }, (_, i) => (i + 1).toString())
            );
            const [darkMode, setDarkMode] = useState(false);
            const [notes, setNotes] = useState('');
            const [accusation, setAccusation] = useState({
                suspects: null,
                weapons: null,
                rooms: null
            });

            useEffect(() => {
                document.body.className = darkMode ? 'dark' : 'light';
            }, [darkMode]);

            const cycleCell = useCallback((category, item, playerIndex) => {
                setState(prevState => {
                    const currentState = prevState[category][item][playerIndex];
                    const currentIndex = STATE_CYCLE.indexOf(currentState);
                    const nextState = STATE_CYCLE[(currentIndex + 1) % STATE_CYCLE.length];

                    return {
                        ...prevState,
                        [category]: {
                            ...prevState[category],
                            [item]: prevState[category][item].map((cellState, idx) =>
                                idx === playerIndex ? nextState : cellState
                            )
                        }
                    };
                });
            }, []);

            const resetAll = useCallback(() => {
                if (confirm('Reset all marks and notes?')) {
                    setState(createInitialState());
                    setPlayerNames(Array.from({ length: PLAYER_COUNT }, (_, i) => (i + 1).toString()));
                    setNotes('');
                    setAccusation({ suspects: null, weapons: null, rooms: null });
                }
            }, [createInitialState]);

            const updatePlayerName = useCallback((index, name) => {
                setPlayerNames(prev => 
                    prev.map((n, i) => i === index ? name.slice(0, 1) : n)
                );
            }, []);

            const toggleDarkMode = useCallback(() => {
                setDarkMode(prev => !prev);
            }, []);

            const isEnvelopeCandidate = useCallback((category, item) => {
                const states = state[category][item];
                return states.every(s => s === CELL_STATES.UNKNOWN || s === CELL_STATES.CROSSED || s === CELL_STATES.UNSURE);
            }, [state]);

            const getPossibleCards = useCallback((category) => {
                return CATEGORIES[category].filter(item => {
                    const states = state[category][item];
                    return !states.some(s => s === CELL_STATES.CHECKED);
                });
            }, [state]);

            const toggleAccusation = useCallback((category, item) => {
                setAccusation(prev => ({
                    ...prev,
                    [category]: prev[category] === item ? null : item
                }));
            }, []);

            const renderCategory = useCallback((categoryName, items) => {
                const displayName = CATEGORY_LABELS[categoryName];

                return (
                    <div key={categoryName} className="category">
                        <h2>{displayName}</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th></th>
                                    {playerNames.map((name, i) => (
                                        <th key={i} className="player-header">
                                            <input
                                                type="text"
                                                className="player-name-input"
                                                value={name}
                                                onChange={(e) => updatePlayerName(i, e.target.value)}
                                                maxLength={1}
                                            />
                                        </th>
                                    ))}
                                </tr>
                            </thead>
                            <tbody>
                                {items.map(item => {
                                    const isCandidate = isEnvelopeCandidate(categoryName, item);
                                    return (
                                        <tr key={item}>
                                            <td className={`item-name ${isCandidate ? 'envelope-candidate' : ''}`}>
                                                {item}
                                            </td>
                                            {state[categoryName][item].map((cellState, playerIdx) => (
                                                <td
                                                    key={playerIdx}
                                                    className={`cell ${cellState}`}
                                                    onClick={() => cycleCell(categoryName, item, playerIdx)}
                                                >
                                                    {STATE_SYMBOLS[cellState]}
                                                </td>
                                            ))}
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                );
            }, [state, playerNames, cycleCell, updatePlayerName, isEnvelopeCandidate]);

            const renderSolutionSection = useCallback(() => {
                const possibleSuspects = getPossibleCards('suspects');
                const possibleWeapons = getPossibleCards('weapons');
                const possibleRooms = getPossibleCards('rooms');

                const accusationText = accusation.suspects && accusation.weapons && accusation.rooms
                    ? `I accuse ${accusation.suspects} with the ${accusation.weapons} in the ${accusation.rooms}!`
                    : 'Select one from each category to make your accusation';

                return (
                    <div className="solution-section">
                        <h2>Make Your Accusation</h2>
                        <div className="solution-content">
                            {[
                                { key: 'suspects', label: 'Who', items: possibleSuspects },
                                { key: 'weapons', label: 'What', items: possibleWeapons },
                                { key: 'rooms', label: 'Where', items: possibleRooms }
                            ].map(({ key, label, items }) => (
                                <div key={key} className="solution-category">
                                    <h3>{label}</h3>
                                    <div className="solution-cards">
                                        {items.map(item => (
                                            <div
                                                key={item}
                                                className={`solution-card ${accusation[key] === item ? 'selected' : ''}`}
                                                onClick={() => toggleAccusation(key, item)}
                                            >
                                                {item}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                        <div className="accusation-display">
                            {accusationText}
                        </div>
                    </div>
                );
            }, [accusation, getPossibleCards, toggleAccusation]);

            return (
                <div className="app">
                    <header>
                        <h1>Clue Detective Notepad</h1>
                        <div className="header-controls">
                            <button onClick={toggleDarkMode} className="btn dark-mode-btn">
                                {darkMode ? '‚òÄÔ∏è Light' : 'üåô Dark'}
                            </button>
                            <button onClick={resetAll} className="btn reset-btn">Reset All</button>
                        </div>
                    </header>

                    <div className="category">
                        <h2>Legend</h2>
                        <div className="legend">
                            {[
                                { state: CELL_STATES.CHECKED, label: 'Has this card' },
                                { state: CELL_STATES.CROSSED, label: 'Ruled out' },
                                { state: CELL_STATES.UNSURE, label: 'Uncertain/guessed' },
                                { state: CELL_STATES.UNKNOWN, label: 'Unknown' }
                            ].map(({ state, label }) => (
                                <div key={state} className="legend-item">
                                    <div className={`legend-box cell ${state}`}>
                                        {STATE_SYMBOLS[state]}
                                    </div>
                                    <span>{label}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                    
                    <div className="categories">
                        {Object.entries(CATEGORIES).map(([category, items]) => 
                            renderCategory(category, items)
                        )}
                    </div>

                    {renderSolutionSection()}

                    <div className="notes-section">
                        <h2>Notes</h2>
                        <textarea
                            className="notes-textarea"
                            value={notes}
                            onChange={(e) => setNotes(e.target.value)}
                            placeholder="Track clues here... (e.g., 'Player M showed me something when I guessed Rope + Library')"
                        />
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ClueTracker />);
    </script>
</body>
</html>
